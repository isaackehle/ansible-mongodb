---

- name: Save the add-shard-to-cluster script
  template: 
    src: ../templates/add-shard-to-cluster.js.j2 
    dest: /tmp/add-shard-to-cluster.js
  run_once: true

- name: Run the add-shard-to-cluster script
  shell: >
    mongo
    --host {{ server_fqdn }}
    --port {{ rs_port }}
    --ssl
    --sslPEMKeyFile {{ cert_path.chain.remote }}
    --sslCAFile {{ cert_path.intermediate.remote }}
    < /tmp/add-shard-to-cluster.js
  run_once: true
  become: true
  register: result
  until: result.rc == 0
  retries: 5
  delay: 3
